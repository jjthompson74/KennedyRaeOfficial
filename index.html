<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horizontal Scrollytelling â€” Fixed Header + Fixed Stage</title>
  <meta name="description" content="Starter layout: fixed header, fixed horizontal stage; vertical scroll drives horizontal movement; mobile/reduced-motion fallbacks.">
  <style>
    :root{
      --nav-h: 56px;                 /* header height */
      --gutter: 5vw;                 /* side padding inside panels */
      --panel-count: 5;              /* updated by JS */
      --progress-h: 3px;             /* set to 0 to hide progress bar */
      color-scheme: light dark;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      line-height:1.6; background:#111; color:#fff;
      overflow-x:hidden; /* never allow page-level horizontal scroll */
      padding-top: var(--nav-h); /* so content never hides under the fixed header */
    }

    /* Visually hidden utility */
    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    a{ color:inherit; text-decoration:none; }
    :where(a,button,[tabindex]):focus-visible{ outline:2px solid currentColor; outline-offset:3px; }

    /* Fixed header stays pinned at the very top */
    .site-header{
      position:fixed; inset:0 0 auto 0; height:var(--nav-h); z-index:1000;
      display:grid; align-items:center; grid-template-rows: 1fr var(--progress-h);
      background: rgba(0,0,0,.65); backdrop-filter: blur(6px);
      border-bottom: 1px solid #222;
    }
    .nav{ display:flex; gap: clamp(12px,3vw,28px); padding:0 2vw; white-space:nowrap; overflow:auto hidden; scrollbar-width:none; }
    .nav::-webkit-scrollbar{ display:none; }
    .nav a{ opacity:.8; }
    .nav a[aria-current="page"], .nav a:hover{ opacity:1; }

    /* Optional progress bar */
    .progress{ height:var(--progress-h); background:rgba(255,255,255,.12); overflow:hidden; }
    .progress__bar{ height:100%; width:0%; background: currentColor; opacity:.9; transform-origin:left center; }

    /* === FIXED STAGE MODEL ===
       The stage is a fixed viewport under the header; it never moves vertically.
       Inside, the track is a horizontal strip of panels that we translate on X.
    */
    .stage{
      position:fixed; left:0; top:var(--nav-h); width:100vw; height:calc(100dvh - var(--nav-h));
      /* 100dvh handles mobile browser UI; desktop treats as 100vh */
      background:#000; z-index: 10; overflow:hidden; contain:layout paint;
    }
    .track{
      display:flex; height:100%; width: calc(var(--panel-count) * 100vw);
      transform: translate3d(0,0,0);
    }

    .panel{
      position:relative; flex:0 0 100vw; height:100%; overflow:hidden;
      display:grid; place-items:center; isolation:isolate; background:#222;
    }
    .panel[data-bg]::before{
      content:""; position:absolute; inset:0; z-index:-1;
      background:center/cover no-repeat var(--bg);
    }
    .content{ width:min(1100px,90vw); padding:6vh var(--gutter); }
    h1,h2{ line-height:1.2; margin:0 0 .5em; }
    h1{ font-size: clamp(2rem, 4vw + 1rem, 4rem); }
    h2{ font-size: clamp(1.5rem, 3vw + .5rem, 3rem); }
    p{ max-width:70ch; margin:0 0 1rem; }

    /* The spacer is invisible content that creates the vertical scroll range. */
    #spacer{ height:100vh; }

   /* Mobile: stack panels vertically AND snap one full panel per scroll */
@media (max-width: 768px) {
  .stage { position: static; top: auto; height: auto; }
  .track { flex-direction: column; width: 100%; transform: none !important; }
  #spacer { display: none; }

  /* Full-height panels below the fixed header */
  html, body { 
    scroll-snap-type: y mandatory; 
    scroll-padding-top: var(--nav-h); /* stop panels below the fixed menu */
  }
  .panel { 
    height: calc(100dvh - var(--nav-h)); 
    scroll-snap-align: start; 
    scroll-snap-stop: always; 
  }
}

/* Reduced-motion: stack panels without special snapping/animation */
@media (prefers-reduced-motion: reduce) {
  .stage { position: static; top: auto; height: auto; }
  .track { flex-direction: column; width: 100%; transform: none !important; }
  #spacer { display: none; }
  .panel { height: min(100vh, 900px); } /* keep it comfortable */
}


    /* Demo badges (remove later) */
    .badge{ position:absolute; top:12px; left:12px; opacity:.7; font-size:.875rem; }
  </style>
</head>
<body>
  <a href="#main" class="sr-only">Skip to content</a>

  <header class="site-header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a href="#home" data-panel="0" aria-current="page">Home</a>
      <a href="#section-1" data-panel="1">Section 1</a>
      <a href="#section-2" data-panel="2">Section 2</a>
      <a href="#section-3" data-panel="3">Section 3</a>
      <a href="#section-4" data-panel="4">Section 4</a>
    </nav>
    <div class="progress" aria-hidden="true"><div class="progress__bar" id="progressBar"></div></div>
  </header>

  <!-- Fixed stage (never moves vertically) -->
  <div class="stage" id="stage" aria-hidden="true">
    <div class="track" id="track">
      <!-- Panel 0 -->
      <section class="panel" id="home" data-bg style="--bg: url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=2000&q=80&auto=format&fit=crop');">
        <span class="badge">Panel 0</span>
        <div class="content">
          <h1>Welcome</h1>
          <p>Hero text here. Replace image URL via the inline <code>--bg</code> style.</p>
        </div>
      </section>
      <!-- Panel 1 -->
      <section class="panel" id="section-1" style="background:#0f172a;">
        <span class="badge">Panel 1</span>
        <div class="content">
          <h2>Section 1</h2>
          <p>Drop your HTML here.</p>
        </div>
      </section>
      <!-- Panel 2 -->
      <section class="panel" id="section-2" data-bg style="--bg: url('https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?w=2000&q=80&auto=format&fit=crop');">
        <span class="badge">Panel 2</span>
        <div class="content">
          <h2>Section 2</h2>
          <p>Swap to a different photo or color.</p>
        </div>
      </section>
      <!-- Panel 3 -->
      <section class="panel" id="section-3" style="background:#111827;">
        <span class="badge">Panel 3</span>
        <div class="content">
          <h2>Section 3</h2>
          <p>Another content area.</p>
        </div>
      </section>
      <!-- Panel 4 -->
      <section class="panel" id="section-4" data-bg style="--bg: url('https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=2000&q=80&auto=format&fit=crop');">
        <span class="badge">Panel 4</span>
        <div class="content">
          <h2>Section 4</h2>
          <p>Final section / CTA.</p>
        </div>
      </section>
    </div>
  </div>

  <!-- Spacer drives the vertical scroll distance; stage sits above it fixed. -->
  <main id="main" role="main">
    <div id="spacer" aria-hidden="true"></div>
  </main>

  <noscript>
    <p style="padding:1rem">This layout uses a small script to translate panels horizontally while you scroll. With JavaScript disabled (or on small screens), panels appear stacked vertically and the header stays fixed.</p>
  </noscript>

  <script>
    (function(){
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isNarrow = () => matchMedia('(max-width: 768px)').matches;

      const root = document.documentElement;
      const stage = document.getElementById('stage');
      const track = document.getElementById('track');
      const panels = Array.from(track.querySelectorAll('.panel'));
      const spacer = document.getElementById('spacer');
      const nav = document.querySelector('.nav');
      const links = Array.from(nav.querySelectorAll('a[data-panel]'));
      const idByIndex = panels.map(p => '#' + p.id);
      const progressEl = document.getElementById('progressBar');

      root.style.setProperty('--panel-count', panels.length);

      let maxX = 0;           // total horizontal distance in px
      let totalScroll = 0;    // vertical scroll range mapping to maxX
      let currentIndex = 0;

      function measure(){
        // Compute max horizontal travel and matching vertical range
        const vw = window.innerWidth;
        maxX = Math.max(0, (panels.length * vw) - vw);
        totalScroll = maxX; // 1:1 mapping: 1px vertical scroll = 1px horizontal move
        spacer.style.height = (totalScroll + window.innerHeight) + 'px';
      }

      function clamp(v, a, b){ return Math.min(b, Math.max(a, v)); }

      let ticking = false;
      function onScroll(){
        if (ticking) return; ticking = true;
        requestAnimationFrame(() => {
          // Map page scroll to horizontal translation
          const y = window.scrollY || window.pageYOffset;
          const progress = totalScroll ? clamp(y / totalScroll, 0, 1) : 0;
          const x = -progress * maxX;
          track.style.transform = `translate3d(${x}px,0,0)`;

          if (progressEl) progressEl.style.width = (progress * 100) + '%';
          const idx = Math.round(progress * (panels.length - 1));
          if (idx !== currentIndex){ currentIndex = idx; updateNav(idx); setHash(idByIndex[idx], false); }
          ticking = false;
        });
      }

      function updateNav(activeIndex){
        links.forEach(a => a.removeAttribute('aria-current'));
        const active = links.find(a => Number(a.dataset.panel) === activeIndex);
        if (active) active.setAttribute('aria-current','page');
      }

      function setHash(id, push){
        if (!id || id === window.location.hash) return;
        try{ push ? history.pushState(null,'',id) : history.replaceState(null,'',id); }
        catch(e){ window.location.hash = id; }
      }

      function scrollToPanel(index){
        const targetProgress = (panels.length > 1) ? index / (panels.length - 1) : 0;
        const y = targetProgress * totalScroll;
        window.scrollTo({ top: y, behavior: 'smooth' });
      }

      function gotoHash(){
        const hash = decodeURIComponent(window.location.hash||'');
        if (!hash || hash === '#') return;
        const id = hash.replace('#','');
        const index = panels.findIndex(p => p.id === id);
        if (index < 0) return;
        if (prefersReduced || isNarrow()) {
          document.getElementById(id)?.scrollIntoView({ behavior:'smooth' });
        } else {
          scrollToPanel(index);
        }
      }

      function bindNav(){
        nav.addEventListener('click', (e) => {
          const a = e.target.closest('a[data-panel]');
          if (!a) return;
          const index = Number(a.dataset.panel);
          if (!Number.isFinite(index)) return;
          e.preventDefault();
          const id = a.getAttribute('href');
          setHash(id, true); // create history entry so back/forward works
          if (prefersReduced || isNarrow()){
            document.querySelector(id)?.scrollIntoView({ behavior:'smooth' });
          } else {
            scrollToPanel(index);
          }
        });

        // Optional keyboard nav: arrows/page up/down
        addEventListener('keydown', (e) => {
          if (['ArrowRight','PageDown'].includes(e.key)) { e.preventDefault(); scrollToPanel(clamp(currentIndex+1,0,panels.length-1)); }
          if (['ArrowLeft','PageUp'].includes(e.key))   { e.preventDefault(); scrollToPanel(clamp(currentIndex-1,0,panels.length-1)); }
          if (e.key === 'Home') { e.preventDefault(); scrollToPanel(0); }
          if (e.key === 'End')  { e.preventDefault(); scrollToPanel(panels.length-1); }
        });
      }

      function refresh(){
        if (prefersReduced || isNarrow()){
          // Fallback mode: stacked panels; no special sizing needed
          track.style.transform = 'none';
          spacer.style.display = 'none';
        } else {
          spacer.style.display = '';
          measure();
          onScroll();
        }
      }

      bindNav();
      addEventListener('resize', refresh);
      addEventListener('orientationchange', refresh);
      addEventListener('load', () => { refresh(); gotoHash(); });
      addEventListener('hashchange', gotoHash);
      addEventListener('scroll', onScroll, { passive:true });
    })();
  </script>
</body>
</html>
